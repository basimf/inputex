YUI.add("inputex-imagecropper",function(e,t){var n=e.Lang,r=e.inputEx;r.ImageCropperField=function(e){r.ImageCropperField.superclass.constructor.call(this,e)},e.extend(r.ImageCropperField,r.Field,{setOptions:function(e){r.ImageCropperField.superclass.setOptions.call(this,e);if(!e.url)throw new Error("'url' has to be provided in options for 'imagecropper' type");this.options.url=e.url,this.options.ratio=n.isArray(e.ratio)?e.ratio[0]/e.ratio[1]:null,this.options.padding=e.padding||10,this.options.minSize=n.isArray(e.minSize)?e.minSize:[0,0]},renderComponent:function(){this.wrapEl=e.Node.create('<div class="inputEx-ImageCropperField-wrapper" style="padding: '+this.options.padding+'px;" />'),this.wrapEl.appendTo(this.fieldContainer),this.el=e.Node.create('<img src="'+this.options.url+'" />'),this.el.appendTo(this.wrapEl),this.mask={},this.mask.n=e.Node.create('<div class="inputEx-ImageCropperField-mask inputEx-ImageCropperField-mask-n" style="top: 0; left: 0;"></div>').appendTo(this.wrapEl),this.mask.s=e.Node.create('<div class="inputEx-ImageCropperField-mask inputEx-ImageCropperField-mask-s" style="bottom: 0; left: 0;"></div>').appendTo(this.wrapEl),this.mask.e=e.Node.create('<div class="inputEx-ImageCropperField-mask inputEx-ImageCropperField-mask-e" style="right: 0; "></div>').appendTo(this.wrapEl),this.mask.w=e.Node.create('<div class="inputEx-ImageCropperField-mask inputEx-ImageCropperField-mask-w" style="left: 0;  "></div>').appendTo(this.wrapEl),this.mask.border=e.Node.create('<div class="inputEx-ImageCropperField-mask-border" style="left: 0;"></div>').appendTo(this.wrapEl),this.el.on("load",function(){var e=this.el.get("region");this.imageSize=[e.width,e.height],this.setValue(this.options.value?this.options.value:{origin:[0,0],size:this.imageSize},!1)},this)},setValue:function(t,n){if(!this.imageSize)return;var r=this._constrain(e.clone(t)),i=this.options.padding,s=i+r.origin[1],o=i+r.origin[1]+r.size[1],u=i+r.origin[0]+r.size[0],a=i+r.origin[0],f=i*2+this.imageSize[0],l=i*2+this.imageSize[1];this.value=r,this.mask.n.setStyles({width:f,height:s}),this.mask.s.setStyles({width:f,height:l-o}),this.mask.e.setStyles({top:s,height:o-s,width:f-u}),this.mask.w.setStyles({top:s,height:o-s,width:a}),this.mask.border.setStyles({top:s-1,left:a-1,width:r.size[0],height:r.size[1]}),n!==!1&&this.fireUpdatedEvt()},getValue:function(){return this.value},initEvents:function(){this.mask.border.on("mousedown",this._onMouseDown,this),this.wrapEl.on("mousedown",this._onMouseDown,this)},_onMouseDown:function(t){t.halt(!0),this.dragging=t.target===this.mask.border,this.imageOrigin=this.el.getXY();var n=[t.pageX-this.imageOrigin[0],t.pageY-this.imageOrigin[1]];this.dragging?this.firstOrigin=n:(this.firstOrigin=null,this.setValue({origin:n,size:[1,1]},!1)),e.one(document).on("mousemove",this._onMouseMove,this),e.one(document).once("mouseup",function(t){e.one(document).detach("mousemove",this._onMouseMove),this._onMouseMove(t),this.fireUpdatedEvt()},this)},_onMouseMove:function(e){e.halt(!0);var t=this.imageOrigin,n=this.firstOrigin,r=Math.min(this.imageSize[0],Math.max(0,e.pageX-t[0])),i=Math.min(this.imageSize[1],Math.max(0,e.pageY-t[1])),s=r-n[0],o=i-n[1],u=[],a=[];this.dragging?(u=this.value.size,a[0]=this.value.origin[0]+s,a[1]=this.value.origin[1]+o,this.firstOrigin=[r,i]):(u=[Math.abs(s),Math.abs(o)],a[0]=s<0?r:n[0],a[1]=o<0?i:n[1]),this.setValue({origin:a,size:u},!1)},_constrain:function(e){var t=this.options.ratio,n=this.imageSize,r=this.options.minSize,i=e.origin,s=e.size;return r&&(s=[Math.min(n[0],Math.max(r[0],s[0])),Math.min(n[1],Math.max(r[1],s[1]))]),t&&(s[0]/s[1]<t?s[1]=Math.round(s[0]/t):s[0]=Math.round(s[1]*t)),this.dragging||(this.firstOrigin?(i[0]<this.firstOrigin[0]&&(i[0]=this.firstOrigin[0]-s[0]),i[1]<this.firstOrigin[1]&&(i[1]=this.firstOrigin[1]-s[1])):this.firstOrigin=[Math.max(0,Math.min(n[0],i[0])),Math.max(0,Math.min(n[1],i[1]))]),i[0]=Math.max(0,Math.min(n[0]-s[0],i[0])),i[1]=Math.max(0,Math.min(n[1]-s[1],i[1])),{origin:i,size:s}}}),r.registerType("imagecropper",r.ImageCropperField)},"@VERSION@",{requires:["inputex-field"],ix_provides:"imagecropper",skinnable:!0});
