YUI.add("inputex-ddlist",function(e,t){var n=e.Lang,r=e.inputEx,i=e.Node.create,s;s=function(e){s.superclass.constructor.call(this,e)},s.LIST_TEMPLATE='<ul class="inputEx-ddlist">{items}</ul>',s.LIST_ITEM_CLASS="inputEx-ddlist-item",s.LIST_ITEM_TEMPLATE='<li class="{class}"><span class="inputEx-ddlist-item-label">{label}</span><input type="hidden" name="{name}" value="{value}" /><button class="unselect" style="display: {removable}">x</button></li>',e.extend(s,r.Field,{setOptions:function(t){s.superclass.setOptions.call(this,t),this.options.items=n.isArray(t.items)?t.items:[],this.options.valueKey=t.valueKey||"value",this.options.labelKey=t.labelKey||"label",this.options.name=t.name||e.guid(),this.options.removable=t.removable||!1,this.options.name.substr(-2)!=="[]"&&(this.options.name+="[]")},renderComponent:function(){var t,n;t=e.Array.reduce(this.options.items,"",this.renderListItem,this),t=e.Lang.sub(s.LIST_TEMPLATE,{items:t}),n=i(t),n.appendTo(this.fieldContainer),this.sortable=new e.Sortable({container:n,nodes:"."+s.LIST_ITEM_CLASS,opacity:".1"}),this.sortable.delegate.dd.on("drag:end",function(e){this.fireUpdatedEvt()},this)},renderListItem:function(t,n){var r=this.options.removable?"":"none";return t+e.Lang.sub(s.LIST_ITEM_TEMPLATE,{"class":s.LIST_ITEM_CLASS,value:n[this.options.valueKey],label:n[this.options.labelKey],name:this.options.name,removable:r})},addItem:function(t){var n=this.sortable.get("container"),r=this.renderListItem("",t),i=e.Node.create(r);i.one(".unselect").on("click",this.removeItemCallback,this),n.append(i),this.sortable.sync()},removeItem:function(e){this.sortable.sync()},removeItemCallback:function(e){var t=e.target.ancestor("li"),n;t&&(n=t.one("input").getAttribute("value"),t.remove(),this.fire("itemRemoved",n,this)),this.sortable.sync()},enable:function(){var e=this.sortable.get("container");e.all(".unselect").each(function(e){e.show()}),s.superclass.enable.call(this)},disable:function(){var e=this.sortable.get("container");e.all(".unselect").each(function(e){e.hide()}),s.superclass.disable.call(this)},clear:function(){var e=this.sortable.get("container");e.empty(),this.sortable.sync()},getValue:function(){return e.one(this.fieldContainer).all("."+s.LIST_ITEM_CLASS+" input").get("value")},setValue:function(t,n){this.clear(),e.Array.test(t)===1?e.Array.each(t,function(e){this.addItem(e)},this):this.addItem(t),s.superclass.setValue.call(this,t,n)}}),r.DDListField=s,r.registerType("ddlist",s)},"@VERSION@",{requires:["inputex-field","array-extras","sortable"],skinnable:!0});
