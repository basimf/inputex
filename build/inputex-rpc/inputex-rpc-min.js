YUI.add("inputex-rpc",function(e,t){var n=e.Lang,r=e.inputEx;r.RPC={generateServiceForm:function(t,i,s){var o=null;n.isObject(i)&&n.isArray(i.fields)?o=i:(o=r.RPC.formForMethod(t),e.mix(o,i,!0));var u=t._methodName||t.name;o.type="form",o.buttons||(o.buttons=[{type:"submit",value:u,onClick:function(){return a.showMask(),t(a.getValue(),{success:function(e){a.hideMask(),n.isObject(s)&&n.isFunction(s.success)&&s.success.call(s.scope||this,e)},failure:function(){a.hideMask()}}),!1}}]);var a=r(o);return a},formForMethod:function(e){var t={},n=e._methodName||e.name;t[n]={id:n,type:"object",properties:{}};for(var i=0;i<e._parameters.length;i++){var s=e._parameters[i];t[n].properties[s.name]=s}var o=new r.JsonSchema.Builder({schemaIdentifierMap:t,defaultOptions:{showMsg:!0}}),u=o.schemaToInputEx(t[n]);return u}};var i=r.RPC;r.RPC.Service=function(e,t){if(n.isString(e))this.smdUrl=e,this.fetch(e,t);else{if(!n.isObject(e))throw new Error("smd should be an object or an url");this._smd=e,this.process(t)}},r.RPC.Service.prototype={_generateService:function(t,r){if(this[r])throw new Error("WARNING: "+t+" already exists for service. Unable to generate function");r.name=t,r._methodName=t;var s=this,o=function(t,o){var u=i.Envelope[r.envelope||s._smd.envelope],a={success:function(e){var t=u.deserialize(e);o.success.call(o.scope||s,t)},failure:function(e){if(n.isFunction(o.failure)){var t=u.deserialize(e);o.failure.call(o.scope||s,t)}},scope:s},f={};if(s._smd.additionalParameters&&n.isArray(s._smd.parameters))for(var l=0;l<s._smd.parameters.length;l++){var c=s._smd.parameters[l];f[c.name]=c["default"]}e.mix(f,t,!0);var h=r.target||s._smd.target,p=/^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(([0-9]{1,5})?\/.*)?$/i;!h.match(p)&&h!=s._smd.target&&(h=s._smd.target+h);if(!!this.smdUrl&&!h.match(p)){var d=this.smdUrl.split("/");d[d.length-1]="",h=d.join("/")+h}var v={target:h,callback:a,data:f,origData:t,opts:o,callbackParamName:r.callbackParamName||s._smd.callbackParamName,transport:r.transport||s._smd.transport},m=u.serialize(s._smd,r,f);e.mix(v,m,!0),i.Transport[v.transport].call(s,v)};return o.name=t,o._methodName=t,o.description=r.description,o._parameters=r.parameters,o},process:function(e){var t=this._smd.services;for(var r in t)if(t.hasOwnProperty(r)){var i=this,s=r.split(".");for(var o=0;o<s.length-1;o++)i=i[s[o]]||(i[s[o]]={});i[s[s.length-1]]=this._generateService(r,t[r])}n.isObject(e)&&n.isFunction(e.success)&&e.success.call(e.scope||this)},fetch:function(t,r){var i={method:"GET",on:{success:function(t,i){try{this._smd=e.JSON.parse(i.responseText),this.process(r)}catch(s){n.isObject(console)&&n.isFunction(console.log)&&console.log(s),n.isFunction(r.failure)&&r.failure.call(r.scope||this,{error:s})}},failure:function(e,i){n.isFunction(r.failure)&&r.failure.call(r.scope||this,{error:"unable to fetch url "+t})}},context:this};e.io(t,i)}},r.RPC.Service._requestId=1,r.RPC.Transport={POST:function(t){return e.io(t.target,{method:"POST",on:{succes:t.callback},data:t.data})},GET:function(t){return e.io(t.target+(t.data?"?"+t.data:""),{method:"GET",on:{success:t.callback}})},REST:function(e){},JSONP:function(t){var r=t.target+(t.target.indexOf("?")==-1?"?":"&")+t.data+"&"+t.callbackParamName+"={callback}";e.jsonp(r,function(e){n.isObject(t.callback)&&n.isFunction(t.callback.success)&&t.callback.success.call(t.callback.scope||this,e)})},"TCP/IP":function(e){throw new Error("TCP/IP transport not implemented !")}},r.RPC.Envelope={URL:{serialize:function(e,t,r){var i=encodeURIComponent,s=[];for(var o in r)if(r.hasOwnProperty(o)){var u=r[o];if(n.isArray(u))for(var a=0;a<u.length;a++)s.push(i(o)+"="+i(u[a]));else s.push(i(o)+"="+i(u))}return{data:s.join("&")}},deserialize:function(e){return e}},PATH:{serialize:function(e,t,r){var i=t.target||e.target,s;if(n.isArray(r))for(s=0;s<r.length;s++)i+="/"+r[s];else for(s in r)r.hasOwnProperty(s)&&(i+="/"+s+"/"+r[s]);return{data:"",target:i}},deserialize:function(e){return e}},JSON:{serialize:function(t,n,r){return{data:e.JSON.stringify(r)}},deserialize:function(e){return e}},"JSON-RPC-1.0":{serialize:function(t,n,r){var s=n.name||n._methodName;return{data:e.JSON.stringify({id:i.Service._requestId++,method:s,params:r})}},deserialize:function(t){return e.JSON.parse(t.responseText)}},"JSON-RPC-2.0":{serialize:function(t,n,r){var s=n.name||n._methodName;return{data:e.JSON.stringify({id:i.Service._requestId++,method:s,version:"json-rpc-2.0",params:r})}},deserialize:function(t){return e.JSON.parse(t.responseText)}}}},"@VERSION@",{requires:["json","inputex","io-base","inputex-jsonschema","jsonp"]});
