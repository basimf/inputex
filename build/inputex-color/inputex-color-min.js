YUI.add("inputex-color",function(e,t){var n=e.inputEx;n.ColorField=function(e){n.ColorField.superclass.constructor.call(this,e)},e.extend(n.ColorField,n.Field,{setOptions:function(e){n.ColorField.superclass.setOptions.call(this,e),this.options.className=e.className?e.className:"inputEx-Field inputEx-ColorField",this.options.zIndex=e.zIndex||4,this.options.palette=e.palette,this.options.colors=e.colors,e.ratio&&(this.options.ratio=e.ratio),e.cellPerLine&&(this.options.cellPerLine=e.cellPerLine)},renderOverlay:function(){this.oOverlay=new e.Overlay({visible:!1,zIndex:this.options.zIndex}),this.oOverlay.render(this.fieldContainer),this.oOverlay.on("visibleChange",function(t){t.newVal?(this.oOverlay.set("align",{node:this.buttonWrapper,points:[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.BL]}),this.outsideHandler=this.oOverlay.get("boundingBox").on("mousedownoutside",function(e){e.target!==this.button&&e.target._node!==this.colorEl&&this.oOverlay.hide()},this)):this.outsideHandler.detach()},this)},_toggleOverlay:function(e){e.preventDefault(),this.renderPalette(),this.oOverlay[this.oOverlay.get("visible")?"hide":"show"]()},renderComponent:function(){this.el=n.cn("input",{type:"hidden",name:this.options.name||"",value:this.options.value||"#FFFFFF"}),this.colorEl=n.cn("div",{className:"inputEx-ColorField-colorArea"},{backgroundColor:this.el.value}),this.wrapEl=n.cn("div",{className:"inputEx-ColorField-Wrapper"}),this.wrapEl.appendChild(this.el),this.wrapEl.appendChild(this.colorEl),this.buttonWrapper=e.Node.create('<span class="inputEx-ColorField-ButtonWrapper"><button type="button" class="inputEx-ColorField-Button"></button></span>'),this.buttonWrapper.appendTo(this.wrapEl),this.button=this.buttonWrapper.one(".inputEx-ColorField-Button"),this.button.on("click",this._toggleOverlay,this,!0),e.one(this.colorEl).on("click",this._toggleOverlay,this,!0),this.fieldContainer.appendChild(this.wrapEl)},renderPalette:function(){this.oOverlay||this.renderOverlay();if(this.paletteRendered)return;var e;e=this.options.palette||1,this.colors=this.options.colors||this.setDefaultColors(e),this.length=this.colors.length,this.ratio=this.options.ratio||[16,9],this.cellPerLine=this.options.cellPerLine||Math.ceil(Math.sqrt(this.length*this.ratio[0]/this.ratio[1])),this.cellPerColumn=Math.ceil(this.length/this.cellPerLine),this.colorGrid=this.renderColorGrid(),this.oOverlay.set("bodyContent",this.colorGrid),this.paletteRendered=!0,this.markSelectedColor()},setDefaultColors:function(e){return n.ColorField.palettes[e-1]},renderColorGrid:function(){var t,r,i,s;this.squares=[],t=n.cn("div",{className:"inputEx-ColorField-Grid"});for(s=0;s<this.length;s++)i=n.cn("div",{className:"inputEx-ColorField-square"},{backgroundColor:this.colors[s]}),t.appendChild(i),this.squares.push(i),(s%this.cellPerLine===this.cellPerLine-1||s===this.length-1)&&t.appendChild(n.cn("br",{clear:"both"}));return r=e.one(t),r.delegate("click",e.bind(this.onColorClick,this),"div.inputEx-ColorField-square"),r},onColorClick:function(e){var t,r;e.halt(),this.oOverlay.hide(),t=e.currentTarget.getStyle("backgroundColor"),r=n.ColorField.ensureHexa(t),this.setValue(r)},setValue:function(e,t){this.el.value=e,this.markSelectedColor(e),n.ColorField.superclass.setValue.call(this,e,t)},getValue:function(){return this.el.value},close:function(){this.oOverlay&&this.oOverlay.hide()},destroy:function(){this.button.purge(),e.one(this.colorEl).purge(),this.colorGrid&&this.colorGrid.purge(),n.ColorField.superclass.destroy.call(this)},markSelectedColor:function(t){var n;t=t||this.getValue();if(!!t&&this.paletteRendered){t=t.toLowerCase();for(n=0;n<this.length;n++)this.colors[n].toLowerCase()===t?e.one(this.squares[n]).addClass("selected"):e.one(this.squares[n]).removeClass("selected")}e.one(this.colorEl).setStyle("backgroundColor",this.el.value)}}),n.ColorField.palettes=[["#FFEA99","#FFFF66","#FFCC99","#FFCAB2","#FF99AD","#FFD6FF","#FF6666","#E8EEF7","#ADC2FF","#ADADFF","#CCFFFF","#D6EAAD","#B5EDBC","#CCFF99"],["#DEDFDE","#FFFF6B","#EFCB7B","#FFBE94","#FFB6B5","#A5E3FF","#A5CBFF","#99ABEF","#EFB2E7","#FF9AAD","#94E7C6","#A5FFD6","#CEFFA5","#E7EF9C","#FFE38C"],["#000000","#993300","#333300","#003300","#003366","#000080","#333399","#333333","#800000","#FF6600","#808000","#008000","#008080","#0000FF","#666699","#808080","#FF0000","#FF9900","#99CC00","#339966","#33CCCC","#3366FF","#800080","#969696","#FF00FF","#FFCC00","#FFFF00","#00FF00","#00FFFF","#00CCFF","#993366","#C0C0C0","#FF99CC","#FFCC99","#FFFF99","#CCFFCC","#CCFFFF","#99CCFF","#CC99FF","#F0F0F0"],["#FFFFCC","#FFFF99","#CCFFCC","#CCFF66","#99FFCC","#CCFFFF","#66CCCC","#CCCCFF","#99CCFF","#9999FF","#6666CC","#9966CC","#CC99FF","#FFCCFF","#FF99FF","#CC66CC","#FFCCCC","#FF99CC","#FFCCCC","#CC6699","#FF9999","#FF9966","#FFCC99","#FFFFCC","#FFCC66","#FFFF99","#CCCC66"],["#D0D0D0","#31A8FA","#8EC1E5","#58D7CF","#89E2BB","#A7F7F8","#F6B77C","#FE993F","#FE6440","#F56572","#FA9AA3","#F7B1CA","#E584AF","#D1C3EF","#AB77B8","#C69FE7","#90D28A","#C2F175","#EDEA9A","#F3DF70","#F8D1AE","#F98064","#F54F5E","#EC9099","#F0B5BA","#EDA0BB","#D375AC","#BC8DBE","#8C77B8"],["#EEEEEE","#84CBFC","#BCDAF0","#9BE7E3","#B9EED7","#CBFBFB","#FAD4B1","#FFC28C","#FFA28D","#F9A3AB","#FCC3C8","#FBD1E0","#F0B6CF","#E4DBF6","#CDAED5","#DDC6F1","#BDE4B9","#DBF7AD","#F5F3C3","#F8ECAA","#FBE4CF","#FCB3A2","#F9969F","#F4BDC2","#F6D3D6","#F5C6D7","#E5ADCE","#D7BBD8","#BAAED5"]],n.ColorField.ensureHexa=function(e){var t,n,r;return e=e.replace(/\s/g,""),e.match(/^rgb\((?:\d{1,3},){2}\d{1,3}\)$/)?(r=function(e){var t=parseInt(e,10).toString(16);return t.length===1&&(t="0"+t),t},t=e.split(/([(,)])/),n="#"+r(t[2])+r(t[4])+r(t[6])):e.match(/^#[\da-fA-F]{6}$/)?n=e:n="#FFFFFF",n},n.registerType("color",n.ColorField,[])},"@VERSION@",{requires:["inputex-field","node-event-delegate","event-outside","overlay"],skinnable:!0,ix_provides:"color"});
