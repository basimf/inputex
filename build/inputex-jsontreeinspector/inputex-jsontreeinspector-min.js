YUI.add("inputex-jsontreeinspector",function(Y,NAME){var lang=Y.Lang,inputEx=Y.inputEx;inputEx.widget.JsonTreeInspector=function(e,t,n){this.hash={},this.el=inputEx.cn("div"),this.cfg=Y.mix({},n),this.cfg.showEmptyObjects=lang.isUndefined(this.cfg.showEmptyObjects)?!0:this.cfg.showEmptyObjects;var r=lang.isString(this.cfg.jsonPath)?inputEx.widget.JsonTreeInspector.jsonPath(t,this.cfg.jsonPath):t;this.buildBranch(r,this.el),(lang.isString(e)?document.getElementById(e):e).appendChild(this.el)},inputEx.widget.JsonTreeInspector.prototype={destroy:function(){Dom.inDocument(this.el)&&this.el.parentNode.removeChild(this.el),Event.purgeElement(this.el,!0)},buildBranch:function(e,t){var n=inputEx.cn("ul",{className:"inputEx-JsonTreeInspector"});for(var r in e)if(e.hasOwnProperty(r)){var i=e[r],s=Y.guid(),o=inputEx.cn("li",{id:s},null,r+":");o.id=s,this.hash[s]={value:i,expanded:!1};var u=!0;if(lang.isObject(i))Y.one(o).addClass("collapsed"),Y.one(o).on("click",this.onItemClick,this,!0),!lang.isFunction(i)&&!this.cfg.showEmptyObjects&&Y.Object.isEmpty(i)&&(u=!1);else if(lang.isArray(i))o.appendChild(inputEx.cn("span",null,null,"[ "+i.length+" element"+(i.length>1?"s":"")+"]")),Y.one(o).addClass("collapsed"),Y.one(o).on("click",this.onItemClick,this,!0);else{var a="";lang.isString(i)?a='"'+inputEx.htmlEntities(i)+'"':i===null?a="null":a=i.toString(),o.appendChild(inputEx.cn("span",{className:"type-"+(i===null?"null":typeof i)},null,a))}u&&n.appendChild(o)}return t.appendChild(n),n},onItemClick:function(e,t){e.halt(),(e.target.hasClass("expanded")||e.target.hasClass("collapsed"))&&this.expandElement(e.target._node)},expandElement:function(e){var t=Y.one(e).hasClass("expanded");Y.one(e).replaceClass(t?"expanded":"collapsed",t?"collapsed":"expanded");var n=this.hash[e.id];t?n.expanded.style.display="none":(n.expanded===!1&&(n.expanded=this.buildBranch(n.value,e)),n.expanded.style.display="")},expandBranch:function(e,t){this.expandElement(e);var n=this;Y.one(e).get("children").item(0).get("children").each(function(e){e.hasClass("collapsed")&&t!=0&&n.expandBranch(e._node,t-1)})},expandAll:function(e){var t=this.el.childNodes[0],n=t.childNodes;for(var r=0;r<n.length;r++){var i=n[r];this.expandBranch(i,e)}}},inputEx.widget.JsonTreeInspector.jsonPath=function(obj,expr,arg){var P={resultType:arg&&arg.resultType||"VALUE",result:[],normalize:function(e){var t=[];return e.replace(/[\['](\??\(.*?\))[\]']/g,function(e,n){return"[#"+(t.push(n)-1)+"]"}).replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"").replace(/#([0-9]+)/g,function(e,n){return t[n]})},asPath:function(e){var t=e.split(";"),n="$";for(var r=1,i=t.length;r<i;r++)n+=/^[0-9*]+$/.test(t[r])?"["+t[r]+"]":"['"+t[r]+"']";return n},store:function(e,t){return e&&(P.result[P.result.length]=P.resultType=="PATH"?P.asPath(e):t),!!e},trace:function(e,t,n){if(e){var r=e.split(";"),i=r.shift();r=r.join(";");if(t&&t.hasOwnProperty(i))P.trace(r,t[i],n+";"+i);else if(i==="*")P.walk(i,r,t,n,function(e,t,n,r,i){P.trace(e+";"+n,r,i)});else if(i==="..")P.trace(r,t,n),P.walk(i,r,t,n,function(e,t,n,r,i){typeof r[e]=="object"&&P.trace("..;"+n,r[e],i+";"+e)});else if(/,/.test(i))for(var s=i.split(/'?,'?/),o=0,u=s.length;o<u;o++)P.trace(s[o]+";"+r,t,n);else/^\(.*?\)$/.test(i)?P.trace(P.eval(i,t,n.substr(n.lastIndexOf(";")+1))+";"+r,t,n):/^\?\(.*?\)$/.test(i)?P.walk(i,r,t,n,function(e,t,n,r,i){P.eval(t.replace(/^\?\((.*?)\)$/,"$1"),r[e],e)&&P.trace(e+";"+n,r,i)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(i)&&P.slice(i,r,t,n)}else P.store(n,t)},walk:function(e,t,n,r,i){if(n instanceof Array)for(var s=0,o=n.length;s<o;s++)s in n&&i(s,e,t,n,r);else if(typeof n=="object")for(var u in n)n.hasOwnProperty(u)&&i(u,e,t,n,r)},slice:function(e,t,n,r){if(n instanceof Array){var i=n.length,s=0,o=i,u=1;e.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(e,t,n,r){s=parseInt(t||s),o=parseInt(n||o),u=parseInt(r||u)}),s=s<0?Math.max(0,s+i):Math.min(i,s),o=o<0?Math.max(0,o+i):Math.min(i,o);for(var a=s;a<o;a+=u)P.trace(a+";"+t,n,r)}},eval:function(x,_v,_vname){try{return $&&_v&&eval(x.replace(/@/g,"_v"))}catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/@/g,"_v").replace(/\^/g,"_a"))}}},$=obj;if(expr&&obj&&(P.resultType=="VALUE"||P.resultType=="PATH"))return P.trace(P.normalize(expr).replace(/^\$;/,""),obj,"$"),P.result.length?P.result:!1}},"@VERSION@",{requires:["inputex"],skinnable:!0});
